<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Switch_Object &mdash; Tracemac 2.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Tracemac 2.0.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for Switch_Object</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created 2013-08-27\n</span>
<span class="sd">@author Mattias Måhl\n</span>
<span class="sd">Class Switch_Object\n</span>
<span class="sd">This is an object to store Switchdata in.\n</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">pysnmp.egg&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">pysnmp.entity.rfc3413.oneliner</span> <span class="kn">import</span> <span class="n">cmdgen</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">Trace_Functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#error handling:</span>
<div class="viewcode-block" id="sw_error"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.sw_error">[docs]</a><span class="k">class</span> <span class="nc">sw_error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="c1">#: specific function to handle exceptions in the class.</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Tracemac error: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span></div>



<div class="viewcode-block" id="Sw_Object"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object">[docs]</a><span class="k">class</span> <span class="nc">Sw_Object</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initilization of the Switch Object setting up the switch and</span>
<span class="sd">        getting the information from the switch through SNMP.\n</span>
<span class="sd">        Defining the tuples and variables to store the switch data. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: Class Sw_Object of Module Switch_Object</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">ipaddress</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        __init__:</span>
<span class="sd">        @param: self(auto) ipaddress(required)</span>
<span class="sd">        @usage: a = Sw_Object(&quot;x.x.x.x&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ipadd</span> <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span>
        <span class="c1">#Contructing the switch-objects data-components.</span>
        <span class="k">if</span> <span class="n">ipaddress</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_ip_address</span><span class="p">(</span><span class="n">ipaddress</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_if_alive</span><span class="p">(</span><span class="n">ipaddress</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="n">sw_error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ipadd</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_ip_address</span> <span class="o">=</span> <span class="n">ipadd</span>          <span class="c1"># Setting Switch IP-Address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_mac_address</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>            <span class="c1"># The Switch own Mac-address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_neighbors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>          <span class="c1"># switch_neigboures - list of the switches neigbours and their ip-addreses.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>            <span class="c1"># interface_list - list of interfaces and their mac-addresses.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mac_found_at_interface</span> <span class="o">=</span> <span class="mi">0</span>         <span class="c1"># Variable to store where the mac_address is found. Default = 0. this is set by find_my_mac_address.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ipaddress</span><span class="p">):</span>
            <span class="c1">#self.switch_mac_address = get_mac_address_from_ip(self.switch_ip_address)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_mac_address_list</span><span class="p">()</span>         <span class="c1"># Gather the switches mac-address table.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_switch_mac_address</span><span class="p">()</span>      <span class="c1"># store the switches own macaddress to the object.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_switch_data</span><span class="p">()</span>

<div class="viewcode-block" id="Sw_Object.cl_switch_interface"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.cl_switch_interface">[docs]</a>    <span class="k">class</span> <span class="nc">cl_switch_interface</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        class cl_switch_interface\n</span>
<span class="sd">        Switch_objects interface object to store mac-adresses assosiated with the interface.\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">mac_address</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">interface</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mac_address</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mac_address</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mac_address</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="Sw_Object.cl_switch_neighbors"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.cl_switch_neighbors">[docs]</a>    <span class="k">class</span> <span class="nc">cl_switch_neighbors</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        class cl_switch_neighbores\n</span>
<span class="sd">        Switch_Objects neighbors object to store the switches neighbors and witch interface their on.\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">interface</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ip_address</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">remote_interface</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">interface</span></div>

<div class="viewcode-block" id="Sw_Object.get_switch_data"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.get_switch_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_switch_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do snmp-recuest to get the system name of the target switch.&quot;&quot;&quot;</span>
        <span class="n">errorIndication</span><span class="p">,</span> <span class="n">errorStatus</span><span class="p">,</span> <span class="n">errorIndex</span><span class="p">,</span> <span class="n">SystemName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_snmp_request</span><span class="p">(</span><span class="s1">&#39;system-name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_name</span> <span class="o">=</span> <span class="n">SystemName</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>
        

<div class="viewcode-block" id="Sw_Object.find_switch_mac_address"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.find_switch_mac_address">[docs]</a>    <span class="k">def</span> <span class="nf">find_switch_mac_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function find_switch_mac_address()\n</span>
<span class="sd">        Do snmp request för oid: 1.3.6.1.4.1.11.2.14.11.5.1.1.6.0 (BaseMacAddress)\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errorIndication</span><span class="p">,</span> <span class="n">errorStatus</span><span class="p">,</span> <span class="n">errorIndex</span><span class="p">,</span> <span class="n">MacAddr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_snmp_request</span><span class="p">(</span><span class="s1">&#39;base_mac_address&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_mac_address</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">MacAddr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">MacAddr</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sw_Object.check_if_alive"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.check_if_alive">[docs]</a>    <span class="k">def</span> <span class="nf">check_if_alive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ipaddress</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function check_if_alive\n</span>
<span class="sd">        function to ping host to see if it&#39;s alive.\n</span>
<span class="sd">        raises error if it&#39;s a fail.\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s1">&#39;ping -c 1 &#39;</span> <span class="o">+</span> <span class="n">ipaddress</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;1 received&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">True</span>
        <span class="k">raise</span> <span class="n">sw_error</span><span class="p">(</span><span class="s1">&#39;Ping to host failed!&#39;</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="Sw_Object.check_ip_address"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.check_ip_address">[docs]</a>    <span class="k">def</span> <span class="nf">check_ip_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ipaddress</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function check_ip_address\n</span>
<span class="sd">        function to check if the ip-address provided is acceptable.\n</span>
<span class="sd">        i.e. number(dot)number(dot)number(dot)number\n</span>
<span class="sd">        return False if not and returns the same string if True\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ipaddress</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">sw_error</span><span class="p">(</span><span class="s1">&#39;Ip-address: </span><span class="si">%s</span><span class="s1"> is in the wrong format. Correct format is xxx.yyy.zzz.aaa&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ipaddress</span><span class="p">))</span></div>


<div class="viewcode-block" id="Sw_Object.find_my_mac_address"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.find_my_mac_address">[docs]</a>    <span class="k">def</span> <span class="nf">find_my_mac_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mac_address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;function to search the Mac-table of the switch to find a specific MAC-adress.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mac_address</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_mac_address</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cl_switch_interface</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mac_address</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_mac</span> <span class="ow">in</span> <span class="n">iface</span><span class="o">.</span><span class="n">mac_address</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_mac</span> <span class="o">==</span> <span class="n">mac_address</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mac_found_at_interface</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">interface</span></div>

<div class="viewcode-block" id="Sw_Object.append_mac_to_interface"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.append_mac_to_interface">[docs]</a>    <span class="k">def</span> <span class="nf">append_mac_to_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">macaddress</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function append_mac_to_interface\n</span>
<span class="sd">        a function to add mac-address to a specific interface. if interface not found add new interface and add the mac_address to it.\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">if_found</span> <span class="o">=</span> <span class="bp">False</span> <span class="c1">#control over if the interface is found.</span>
        <span class="k">for</span> <span class="n">intf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_list</span><span class="p">:</span> <span class="c1"># loop through the inteface list to find the specific interface.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">intf</span><span class="o">.</span><span class="n">interface</span> <span class="o">==</span> <span class="n">interface</span><span class="p">):</span> <span class="c1">#check if interface number matches, if so add the mac-address.</span>
                <span class="n">intf</span><span class="o">.</span><span class="n">mac_address</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">macaddress</span><span class="p">)</span>
                <span class="n">if_found</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">if_found</span> <span class="o">==</span> <span class="bp">False</span><span class="p">):</span> <span class="c1"># if interface not found add the new interface and the mac-address to the interface.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interface_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cl_switch_interface</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">macaddress</span><span class="p">))</span></div>

<div class="viewcode-block" id="Sw_Object.append_neighbor"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.append_neighbor">[docs]</a>    <span class="k">def</span> <span class="nf">append_neighbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function append_neighbor\n</span>
<span class="sd">        function to append Neighbor to the switchobjects array och neighbors.\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">exists</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_neighbors</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">interface</span> <span class="o">==</span> <span class="n">interface</span><span class="p">):</span>
                <span class="n">exists</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_neighbors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cl_switch_neighbors</span><span class="p">(</span><span class="n">interface</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_neighbors</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">interface</span> <span class="o">==</span> <span class="n">interface</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">):</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;remote_interface&quot;</span><span class="p">):</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">remote_inteface</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ip_address&quot;</span><span class="p">):</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">ip_address</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>
        
        
        
<div class="viewcode-block" id="Sw_Object.get_mac_address_list"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.get_mac_address_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_mac_address_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function get_mac_address_list\n</span>
<span class="sd">        Does a SNMP-request to gather the mac-address-table from this switch-object.\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errorIndication</span><span class="p">,</span> <span class="n">errorStatus</span><span class="p">,</span> <span class="n">errorIndex</span><span class="p">,</span> <span class="n">varBindTable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_snmp_request</span><span class="p">(</span><span class="s1">&#39;mac_interface&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">errorStatus</span><span class="p">):</span>
            <span class="nb">exit</span>                    <span class="c1">## This should be a Raise statement.</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">varBindTable</span><span class="p">:</span>
            <span class="n">hx</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">mys</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">hx</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append_mac_to_interface</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">mys</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sw_Object.is_interface_a_neighbor"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.is_interface_a_neighbor">[docs]</a>    <span class="k">def</span> <span class="nf">is_interface_a_neighbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function is_interface_a_neighbor\n</span>
<span class="sd">        Check to see if the interface has neighbors registered.\n</span>
<span class="sd">        Returns True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_neighbors</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">interface</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">interface</span><span class="p">)):</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="Sw_Object.get_neighbor_at_interface"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.get_neighbor_at_interface">[docs]</a>    <span class="k">def</span> <span class="nf">get_neighbor_at_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function get_neighbor_at_interface\n</span>
<span class="sd">        function to get the neighbor at a specific interface.\n</span>
<span class="sd">        searches registered neighbors and returns a hit.\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_neighbors</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">interface</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">interface</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">a</span></div>

<div class="viewcode-block" id="Sw_Object.get_interface"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.get_interface">[docs]</a>    <span class="k">def</span> <span class="nf">get_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function get_interface\n</span>
<span class="sd">        searches registered interfaces and returns the interface_object\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">interface</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">interface</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">a</span></div>

<div class="viewcode-block" id="Sw_Object.get_neighbors"><a class="viewcode-back" href="../Switch_Object.html#Switch_Object.Sw_Object.get_neighbors">[docs]</a>    <span class="k">def</span> <span class="nf">get_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function get_neighbores\n</span>
<span class="sd">        gets the list of neighbors and stores them in the list &#39;switch_neighbors&#39;\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errorIndication</span><span class="p">,</span> <span class="n">errorStatus</span><span class="p">,</span> <span class="n">errorIndex</span><span class="p">,</span> <span class="n">ResultTable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_snmp_request</span><span class="p">(</span><span class="s1">&#39;neighbors&#39;</span><span class="p">)</span>
        <span class="n">errorIndication2</span><span class="p">,</span> <span class="n">errorStatus2</span><span class="p">,</span> <span class="n">errorIndex2</span><span class="p">,</span> <span class="n">ResultTable2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_snmp_request</span><span class="p">(</span><span class="s1">&#39;neighbors_ip&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">errorStatus</span><span class="p">):</span>
            <span class="nb">exit</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ResultTable</span><span class="p">:</span>
                <span class="n">oid</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;()&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">oid</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="o">==</span> <span class="mi">8</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">append_neighbor</span><span class="p">(</span><span class="n">oid</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="s1">&#39;remote_interface&#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">oid</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="o">==</span> <span class="mi">9</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">append_neighbor</span><span class="p">(</span><span class="n">oid</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ResultTable2</span><span class="p">:</span>
                <span class="n">oid</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;()&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">oid</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                        <span class="n">ip_add</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">oid</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span> <span class="n">oid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">oid</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">oid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">iface</span> <span class="o">=</span> <span class="n">oid</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">append_neighbor</span><span class="p">(</span><span class="n">iface</span><span class="p">,</span> <span class="s2">&quot;ip_address&quot;</span><span class="p">,</span> <span class="n">ip_add</span><span class="p">)</span></div>
   
    <span class="k">def</span> <span class="nf">_do_snmp_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        private function _do_snmp_request\n</span>
<span class="sd">        @param request\n</span>
<span class="sd">        request can be one of the following\n</span>
<span class="sd">             \tneighbors\n</span>
<span class="sd">             \tneighbors_ip\n</span>
<span class="sd">             \tbase_mac_adress\n</span>
<span class="sd">             \tmac_interface\n</span>
<span class="sd">             \tsystem-name\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">request</span> <span class="o">==</span> <span class="s1">&#39;neighbors&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cmdgen</span><span class="o">.</span><span class="n">CommandGenerator</span><span class="p">()</span><span class="o">.</span><span class="n">nextCmd</span><span class="p">(</span>
            <span class="n">cmdgen</span><span class="o">.</span><span class="n">CommunityData</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">cmdgen</span><span class="o">.</span><span class="n">UdpTransportTarget</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_ip_address</span><span class="p">,</span> <span class="mi">161</span><span class="p">)),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">8802</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">request</span> <span class="o">==</span> <span class="s1">&#39;neighbors_ip&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cmdgen</span><span class="o">.</span><span class="n">CommandGenerator</span><span class="p">()</span><span class="o">.</span><span class="n">nextCmd</span><span class="p">(</span>
            <span class="n">cmdgen</span><span class="o">.</span><span class="n">CommunityData</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">cmdgen</span><span class="o">.</span><span class="n">UdpTransportTarget</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_ip_address</span><span class="p">,</span> <span class="mi">161</span><span class="p">)),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">8802</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">request</span> <span class="o">==</span> <span class="s1">&#39;base_mac_address&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cmdgen</span><span class="o">.</span><span class="n">CommandGenerator</span><span class="p">()</span><span class="o">.</span><span class="n">getCmd</span><span class="p">(</span>
            <span class="n">cmdgen</span><span class="o">.</span><span class="n">CommunityData</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">cmdgen</span><span class="o">.</span><span class="n">UdpTransportTarget</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_ip_address</span><span class="p">,</span> <span class="mi">161</span><span class="p">)),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span> <span class="c1">#1.3.6.1.4.1.11.2.14.11.5.1.1.6.0</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">request</span> <span class="o">==</span> <span class="s1">&#39;mac_interface&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cmdgen</span><span class="o">.</span><span class="n">CommandGenerator</span><span class="p">()</span><span class="o">.</span><span class="n">nextCmd</span><span class="p">(</span>
            <span class="n">cmdgen</span><span class="o">.</span><span class="n">CommunityData</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">cmdgen</span><span class="o">.</span><span class="n">UdpTransportTarget</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_ip_address</span><span class="p">,</span> <span class="mi">161</span><span class="p">)),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
	    <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">request</span> <span class="o">==</span> <span class="s1">&#39;system-name&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cmdgen</span><span class="o">.</span><span class="n">CommandGenerator</span><span class="p">()</span><span class="o">.</span><span class="n">getCmd</span><span class="p">(</span>
            <span class="n">cmdgen</span><span class="o">.</span><span class="n">CommunityData</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">cmdgen</span><span class="o">.</span><span class="n">UdpTransportTarget</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_ip_address</span><span class="p">,</span> <span class="mi">161</span><span class="p">)),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Mattias Måhl.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
    </div>

    

    
  </body>
</html>